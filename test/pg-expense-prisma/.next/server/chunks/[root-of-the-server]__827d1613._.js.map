{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 61, "column": 0}, "map": {"version":3,"sources":["file:///Users/pjhampton/workspace/clickhouse.build/test/pg-expense-prisma/lib/db.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client'\n\nconst globalForPrisma = globalThis as unknown as {\n  prisma: PrismaClient | undefined\n}\n\nconst prisma =\n  globalForPrisma.prisma ??\n  new PrismaClient({\n    log: ['query'],\n  })\n\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma\n\nexport default prisma"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,kBAAkB;AAIxB,MAAM,SACJ,gBAAgB,MAAM,IACtB,IAAI,6IAAY,CAAC;IACf,KAAK;QAAC;KAAQ;AAChB;AAEF,wCAA2C,gBAAgB,MAAM,GAAG;uCAErD","debugId":null}},
    {"offset": {"line": 79, "column": 0}, "map": {"version":3,"sources":["file:///Users/pjhampton/workspace/clickhouse.build/test/pg-expense-prisma/app/api/expenses/stats/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport prisma from '@/lib/db';\n\nexport async function GET(request: NextRequest) {\n  try {\n    const { searchParams } = new URL(request.url);\n    const startDate = searchParams.get('startDate');\n    const endDate = searchParams.get('endDate');\n\n    const where: any = {};\n\n    if (startDate) {\n      where.date = { ...where.date, gte: new Date(startDate) };\n    }\n\n    if (endDate) {\n      where.date = { ...where.date, lte: new Date(endDate) };\n    }\n\n    // Total expenses\n    const totalStats = await prisma.expense.aggregate({\n      where,\n      _count: { id: true },\n      _sum: { amount: true }\n    });\n\n    // Expenses by category\n    const categoryStats = await prisma.expense.groupBy({\n      by: ['category'],\n      where,\n      _count: { id: true },\n      _sum: { amount: true },\n      orderBy: { _sum: { amount: 'desc' } }\n    });\n\n    // Monthly aggregation using raw SQL for DATE_TRUNC\n    let monthlyQuery = `\n      SELECT\n        DATE_TRUNC('month', date) as month,\n        COUNT(*) as count,\n        SUM(amount) as total\n      FROM expenses\n      WHERE 1=1\n    `;\n    const queryParams: any[] = [];\n\n    if (startDate) {\n      queryParams.push(startDate);\n      monthlyQuery += ` AND date >= $${queryParams.length}`;\n    }\n\n    if (endDate) {\n      queryParams.push(endDate);\n      monthlyQuery += ` AND date <= $${queryParams.length}`;\n    }\n\n    monthlyQuery += `\n      GROUP BY DATE_TRUNC('month', date)\n      ORDER BY month DESC\n    `;\n\n    const monthlyStats = await prisma.$queryRawUnsafe<Array<{\n      month: Date;\n      count: bigint;\n      total: number;\n    }>>(monthlyQuery, ...queryParams);\n\n    // Daily aggregation\n    const dailyStats = await prisma.expense.groupBy({\n      by: ['date'],\n      where,\n      _count: { id: true },\n      _sum: { amount: true },\n      orderBy: { date: 'desc' },\n      take: 30\n    });\n\n    const stats = {\n      total: {\n        count: totalStats._count.id,\n        amount: totalStats._sum.amount ? Number(totalStats._sum.amount) : 0\n      },\n      byCategory: categoryStats.map(stat => ({\n        category: stat.category || 'Uncategorized',\n        count: stat._count.id,\n        total: stat._sum.amount ? Number(stat._sum.amount) : 0\n      })),\n      byMonth: monthlyStats.map(stat => ({\n        month: stat.month,\n        count: Number(stat.count),\n        total: Number(stat.total)\n      })),\n      daily: dailyStats.map(stat => ({\n        date: stat.date,\n        count: stat._count.id,\n        total: stat._sum.amount ? Number(stat._sum.amount) : 0\n      }))\n    };\n\n    return NextResponse.json(stats);\n  } catch (error) {\n    console.error('Error fetching expense stats:', error);\n    return NextResponse.json(\n      { error: 'Internal server error' },\n      { status: 500 }\n    );\n  }\n}"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACF,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;QAC5C,MAAM,YAAY,aAAa,GAAG,CAAC;QACnC,MAAM,UAAU,aAAa,GAAG,CAAC;QAEjC,MAAM,QAAa,CAAC;QAEpB,IAAI,WAAW;YACb,MAAM,IAAI,GAAG;gBAAE,GAAG,MAAM,IAAI;gBAAE,KAAK,IAAI,KAAK;YAAW;QACzD;QAEA,IAAI,SAAS;YACX,MAAM,IAAI,GAAG;gBAAE,GAAG,MAAM,IAAI;gBAAE,KAAK,IAAI,KAAK;YAAS;QACvD;QAEA,iBAAiB;QACjB,MAAM,aAAa,MAAM,sHAAM,CAAC,OAAO,CAAC,SAAS,CAAC;YAChD;YACA,QAAQ;gBAAE,IAAI;YAAK;YACnB,MAAM;gBAAE,QAAQ;YAAK;QACvB;QAEA,uBAAuB;QACvB,MAAM,gBAAgB,MAAM,sHAAM,CAAC,OAAO,CAAC,OAAO,CAAC;YACjD,IAAI;gBAAC;aAAW;YAChB;YACA,QAAQ;gBAAE,IAAI;YAAK;YACnB,MAAM;gBAAE,QAAQ;YAAK;YACrB,SAAS;gBAAE,MAAM;oBAAE,QAAQ;gBAAO;YAAE;QACtC;QAEA,mDAAmD;QACnD,IAAI,eAAe,CAAC;;;;;;;IAOpB,CAAC;QACD,MAAM,cAAqB,EAAE;QAE7B,IAAI,WAAW;YACb,YAAY,IAAI,CAAC;YACjB,gBAAgB,CAAC,cAAc,EAAE,YAAY,MAAM,EAAE;QACvD;QAEA,IAAI,SAAS;YACX,YAAY,IAAI,CAAC;YACjB,gBAAgB,CAAC,cAAc,EAAE,YAAY,MAAM,EAAE;QACvD;QAEA,gBAAgB,CAAC;;;IAGjB,CAAC;QAED,MAAM,eAAe,MAAM,sHAAM,CAAC,eAAe,CAI7C,iBAAiB;QAErB,oBAAoB;QACpB,MAAM,aAAa,MAAM,sHAAM,CAAC,OAAO,CAAC,OAAO,CAAC;YAC9C,IAAI;gBAAC;aAAO;YACZ;YACA,QAAQ;gBAAE,IAAI;YAAK;YACnB,MAAM;gBAAE,QAAQ;YAAK;YACrB,SAAS;gBAAE,MAAM;YAAO;YACxB,MAAM;QACR;QAEA,MAAM,QAAQ;YACZ,OAAO;gBACL,OAAO,WAAW,MAAM,CAAC,EAAE;gBAC3B,QAAQ,WAAW,IAAI,CAAC,MAAM,GAAG,OAAO,WAAW,IAAI,CAAC,MAAM,IAAI;YACpE;YACA,YAAY,cAAc,GAAG,CAAC,CAAA,OAAQ,CAAC;oBACrC,UAAU,KAAK,QAAQ,IAAI;oBAC3B,OAAO,KAAK,MAAM,CAAC,EAAE;oBACrB,OAAO,KAAK,IAAI,CAAC,MAAM,GAAG,OAAO,KAAK,IAAI,CAAC,MAAM,IAAI;gBACvD,CAAC;YACD,SAAS,aAAa,GAAG,CAAC,CAAA,OAAQ,CAAC;oBACjC,OAAO,KAAK,KAAK;oBACjB,OAAO,OAAO,KAAK,KAAK;oBACxB,OAAO,OAAO,KAAK,KAAK;gBAC1B,CAAC;YACD,OAAO,WAAW,GAAG,CAAC,CAAA,OAAQ,CAAC;oBAC7B,MAAM,KAAK,IAAI;oBACf,OAAO,KAAK,MAAM,CAAC,EAAE;oBACrB,OAAO,KAAK,IAAI,CAAC,MAAM,GAAG,OAAO,KAAK,IAAI,CAAC,MAAM,IAAI;gBACvD,CAAC;QACH;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,iCAAiC;QAC/C,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAwB,GACjC;YAAE,QAAQ;QAAI;IAElB;AACF","debugId":null}}]
}